#!/bin/bash
# Cleanup old backend processes that are not managed by PM2

echo "ðŸ” Checking for old backend processes..."

# Find all tsx/node processes running server.ts that are NOT managed by PM2
OLD_PROCESSES=$(ps aux | grep -E "tsx.*server\.ts" | grep -v "PM2" | grep -v grep | awk '{print $2}')

if [ -z "$OLD_PROCESSES" ]; then
  echo "âœ… No old processes found"
else
  echo "ðŸ—‘ï¸  Found old processes to kill:"
  ps aux | grep -E "tsx.*server\.ts" | grep -v "PM2" | grep -v grep
  
  echo ""
  echo "Killing old processes: $OLD_PROCESSES"
  for PID in $OLD_PROCESSES; do
    kill -9 $PID 2>/dev/null && echo "  âœ“ Killed process $PID"
  done
  
  echo "âœ… Cleanup complete"
fi

echo ""
echo "ðŸ“Š Current PM2 processes:"
pm2 list
